<%- include('../layouts/header'); -%>
<script src="/js/product.js"></script>
<main class="container">
  <h1>Products management</h1>
  <form action="/products" method="get">
    <div class="row">
      <div class="col-4">
        <input class="form-control" name="q" type="text" />
      </div>
      <button type="submit" class="btn btn-outline-warning col-2">
        Search
      </button>
    </div>
  </form>

  <br />
  <h3>Filter</h3>
  <div class="row">
      <a
        href="/products?minPrice=0&maxPrice=999"
        class="btn btn-outline-primary col-3"
      >
        Dưới 1000
      </a>
      <a
        href="/products?minPrice=1000&maxPrice=2000"
        class="btn btn-outline-primary col-3"
      >
        Từ 1000 đến 2000
      </a>
      <a
        href="/products?minPrice=2000&maxPrice=3000"
        class="btn btn-outline-primary col-3"
      >
        Từ 2000 đến 3000
      </a>
      <a href="/products?minPrice=3001" class="btn btn-outline-primary col-3">
        Lớn hơn 3000
      </a>
    </div>
  </div>
  <br />
  <a href="/products/new" class="btn btn-outline-warning"> Create </a>
  <table class="table">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Name</th>
        <th scope="col">Description</th>
        <th scope="col">Image</th>
        <th scope="col">Price</th>
        <th scope="col">Quantity</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody>
        <% if (products.length === 0) { %>
            <tr>
                <td colspan="7" class="text-center">Không có sản phẩm nào!</td>
            </tr>
        <% } else { %>
            <% products.forEach(function(item, index){ %>
                <tr>
                    <th scope="row"><%= index + 1 %></th>
                    <td><%= item.name %></td>
                    <td><%= item.description %></td>
                    <td><img src="<%= item.image %>" width="50"></td>
                    <td><%= item.price %></td>
                    <td><%= item.quantity %></td>
                    <td>
                        <button id="<%= item._id %>" onclick="confirmDelete(this)" class="btn btn-outline-danger">
                            <i class="bi bi-trash3"></i>
                        </button>
                        <a href="/products/<%= item._id %>/edit" class="btn btn-outline-warning">
                            <i class="bi bi-pencil-square"></i>
                        </a>
                    </td>
                </tr>
            <% }); %>
        <% } %>
    </tbody>    
  </table>
  <nav aria-label="Page navigation example">
    <% if (pages > 1) { %>
      <ul class="pagination">
        <% if (currentPage > 1) { %>
          <li class="page-item">
            <a class="page-link" href="/products?page=<%= currentPage - 1 %>&q=<%= q %>&minPrice=<%= minPrice %>&maxPrice=<%= maxPrice %>">
              Previous
            </a>
          </li>
        <% } %>
  
        <% for (let i = 1; i <= pages; i++) { %>
          <li class="page-item <%= currentPage === i ? 'active' : '' %>">
            <a class="page-link" href="/products?page=<%= i %>&q=<%= q %>&minPrice=<%= minPrice %>&maxPrice=<%= maxPrice %>">
              <%= i %>
            </a>
          </li>
        <% } %>
  
        <% if (currentPage < pages) { %>
          <li class="page-item">
            <a class="page-link" href="/products?page=<%= currentPage + 1 %>&q=<%= q %>&minPrice=<%= minPrice %>&maxPrice=<%= maxPrice %>">
              Next
            </a>
          </li>
        <% } %>
      </ul>
    <% } %>
  </nav>  
</main>
<%- include('../layouts/footer'); -%>
